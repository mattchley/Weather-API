<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>New York Times Search</title>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />

</head>

<nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 h1">Weather Dashboard</span>
</nav>

<body>
    <div class="container">
        <div class="row">
            <div class='col-3'>
                Search for a city:
                <form class="form-inline my-2 my-lg-0">
                    <input class="form-control mr-sm-2" id='city-input' type="search" placeholder="Search"
                        aria-label="Search">
                    <button class="btn btn-outline-success my-2 my-sm-0" id="city-search" type="submit">City
                        Name</button>
                </form>
                <ul id='city-list'></ul>
            </div>
            <div class="row">
                <div class="col-9 main">
                    <div class="jumbotron jumbotron-fluid">
                        <h1 id="main-title" class="display-9"></h1>
                        <p id="main-temp" class="lead"></p>
                        <p id="main-humidity" class="lead"></p>
                        <p id="main-wind" class="lead"></p>
                        <p id="main-UV" class="lead"></p>
                    </div>
                </div>
            </div>
                <div class="row">
                    <div class="col-1 5-day">
                        <div class="card" style="width: 18rem;">
                            <h5 id="five-title-one" class="card-title">Card title</h5>
                            <img src="https://via.placeholder.com/150

                            C/O https://placeholder.com/#How_To_Set_Image_Size" class="card-img-top" alt="...">
                            <div class="card-body">
                                <p id="five-temp-one" class="lead"></p>
                                <p id="five-humidity-one" class="lead"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 5-day">
                        <div class="card" style="width: 18rem;">
                            <h5 id="five-title-two" class="card-title">Card title</h5>
                            <img src="https://via.placeholder.com/150

                            C/O https://placeholder.com/#How_To_Set_Image_Size" class="card-img-top" alt="...">
                            <div class="card-body">
                                <p id="five-temp-two" class="lead"></p>
                                <p id="five-humidity-two" class="lead"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 5-day">
                        <div class="card" style="width: 18rem;">
                            <h5 id="five-title-three" class="card-title">Card title</h5>
                            <img src="https://via.placeholder.com/150

                            C/O https://placeholder.com/#How_To_Set_Image_Size" class="card-img-top" alt="...">
                            <div class="card-body">
                                <p id="five-temp-three" class="lead"></p>
                                <p id="five-humidity-three" class="lead"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 5-day">
                        <div class="card" style="width: 18rem;">
                            <h5 id="five-title-four" class="card-title">Card title</h5>
                            <img src="https://via.placeholder.com/150

                            C/O https://placeholder.com/#How_To_Set_Image_Size" class="card-img-top" alt="...">
                            <div class="card-body">
                                <p id="five-temp-four" class="lead"></p>
                                <p id="five-humidity-four" class="lead"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-1 5-day">
                        <div class="card" style="width: 18rem;">
                            <h5 id="five-title-five" class="card-title">Card title</h5>
                            <img src="https://via.placeholder.com/150

                            C/O https://placeholder.com/#How_To_Set_Image_Size" class="card-img-top" alt="...">
                            <div class="card-body">
                                <p id="five-temp-five" class="lead"></p>
                                <p id="five-humidity-five" class="lead"></p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <!-- Code to the JavaScript File -->
        <script text="text/javascript">
            // Variables
            var m = moment();
            var date = m.format('l')
            var citysearch = $('#city-search')
            var cityInput = $('#city-input')
            var citylist = $('#city-list')
            var city = "Stockholm"
            var cities = [];

            // Main Content in Jumbotron
            var mainWeatherTitle = $('#main-title')
            var mainWeatherTemp = $('#main-temp')
            var mainWeatherHumidity = $('#main-humidity')
            var mainWeatherWind = $('#main-wind')
            var mainWeatherUV = $('#main-UV')

            // 5Day content
            var fiveWeatherTitleOne = $('#five-title-one');
            var fiveWeatherTempOne = $('#five-temp-one');
            var fiveWeatherHumidityOne = $('#five-humidity-one');

            var fiveWeatherTitleTwo = $('#five-title-two');
            var fiveWeatherTempTwo = $('#five-temp-two');
            var fiveWeatherHumidityTwo = $('#five-temp-two');

            var fiveWeatherTitleThree = $('#five-title-three');
            var fiveWeatherTempThree = $('#five-temp-three');
            var fiveWeatherHumidityThree = $('#five-humidity-three');

            var fiveWeatherTitleFour = $('#five-title-four');
            var fiveWeatherTempFour = $('#five-temp-four');
            var fiveWeatherHumidityFour = $('#five-humidity-four');

            var fiveWeatherTitleFive = $('#five-title-five');
            var fiveWeatherTempFive = $('#five-temp-five');
            var fiveWeatherHumidityFive = $('#five-humidityfive');

            var APIKey = "3a92bc0a0ca29575a3569a00c0268022";
            var queryURL = "https://api.openweathermap.org/data/2.5/weather?" +
                "q=" + city + "&units=imperial&APPID=" + APIKey;


            // seperate QueryURL option
            // function buildQueryURL (){
            //     var queryURL = "http://api.openweather.org/data/2.5/"
            //     var queryParams = {"appid": "3a92bc0a0ca29575a3569a00c0268022"};
            //     queryParams.q = $('#city-input')
            //         .val()
            //         .trim();


            // };


            // // for 5-day forecast
            // "http://api.openweathermap.org/data/2.5/forecast?lat=" + lat + "&lon="+ lon;


            // maybe seperate URLs for UV and 5-day?

            // init();

            // function init() {
            //     // Get stored cities from localStorage
            //     // Parsing the JSON string to an object
            //     var storedCities = localStorage.getItem("cities");

            //     // If cities were retrieved from localStorage, update the cities array to it
            //     if (storedCities !== null) {
            //         cities = storedCities;
            //     }

            //     // Render cities to the DOM
            //     // renderStoredCity();
            // }


            function renderMainData() {
                $.ajax({

                    url: queryURL,
                    method: "GET"
                })
                    .then(function (response) {

                        // Log the queryURL
                        console.log(queryURL);

                        // Log the resulting object
                        console.log(response);

                        var main = response.name;
                        var mainTemp = response.main.temp;
                        var mainHumidity = response.main.humidity;
                        var mainWind = response.wind.speed;
                        var img = $('<img>');

                        //    UV is a seperate call, Variables here
                        var lat = response.coord.lat;
                        var lon = response.coord.lon;
                        var uvURL = "http://api.openweathermap.org/data/2.5/uvi?appid=3a92bc0a0ca29575a3569a00c0268022" + "&lat=" + lat + "&lon=" + lon;

                        // Generate content
                        // placeholder while i look for the image src
                        // img.attr('src', response.weather[0].icon)

                        mainWeatherTitle.text(main + " " + "(" + date + ")");
                        mainWeatherTemp.text('Temp: ' + mainTemp);
                        mainWeatherHumidity.text('Humidity: ' + mainHumidity);
                        mainWeatherWind.text('Wind Speed: ' + mainWind);

                        $.ajax({

                            url: uvURL,
                            method: "GET"
                        })
                            .then(function (response) {

                                var uvResult = response.value;
                                mainWeatherUV.text('UV Index: ' + uvResult);
                                console.log(response)
                            })
                    });


            }
            renderMainData();

            function renderFiveDay() {
            $.ajax({

                url: queryURL,
                method: "GET"
            })
                .then(function (response) {
                    var lat = response.coord.lat;
                    var lon = response.coord.lon;

                    var fiveURL = "http://api.openweathermap.org/data/2.5/forecast?appid=3a92bc0a0ca29575a3569a00c0268022&" + "&lat=" + lat + "&lon=" + lon
                    $.ajax({

                        url: fiveURL,
                        method: "GET"
                    })
                        .then(function (response) {
                            console.log(response)
                            var fiveDayTitleOne = response.list[0].dt_txt;
                            var fiveDayTempOne = response.list[0].main.temp;
                            var fiveDayHumidityOne = response.list[0].main.humidity;

                            var fiveDayTitleTwo = response.list[1].dt_txt;
                            var fiveDayTempTwo = response.list[1].main.temp;
                            var fiveDayHumidityTwo = response.list[1].main.humidity;

                            var fiveDayTitleThree = response.list[2].dt_txt;
                            var fiveDayTempThree = response.list[2].main.temp;
                            var fiveDayHumidityThree = response.list[2].main.humidity;

                            var fiveDayTitleFour = response.list[3].dt_txt;
                            var fiveDayTempFour = response.list[3].main.temp;
                            var fiveDayHumidityFour = response.list[3].main.humidity;

                            var fiveDayTitleFive = response.list[4].dt_txt;
                            var fiveDayTempFive = response.list[4].main.temp;
                            var fiveDayHumidityFive = response.list[4].main.humidity;

                            fiveWeatherTitleOne.text(fiveDayTitleOne)
                            fiveWeatherTempOne.text('Temp: ' + fiveDayTempOne + 'F')
                            fiveWeatherHumidityOne.text('Humidity: ' + fiveDayHumidityOne + '%')
                            
                            fiveWeatherTitleTwo.text(fiveDayTitleTwo)
                            fiveWeatherTempTwo.text('Temp: ' + fiveDayTempTwo + 'F')
                            fiveWeatherHumidityTwo.text('Humidity: ' + fiveDayHumidityTwo + '%')
                            
                            fiveWeatherTitleThree.text(fiveDayTitleThree)
                            fiveWeatherTempThree.text('Temp: ' + fiveDayTempThree + 'F')
                            fiveWeatherHumidityThre.text('Humidity: ' + fiveDayHumidityThree + '%')
                            
                            fiveWeatherTitleFour.text(fiveDayTitleFour)
                            fiveWeatherTempFour.text('Temp: ' + fiveDayTempFour + 'F')
                            fiveWeatherHumidityFour.text('Humidity: ' + fiveDayHumidityFour + '%')
                            
                            fiveWeatherTitleFive.text(fiveDayTitleFive)
                            fiveWeatherTempFive.text('Temp: ' + fiveDayTempFive + 'F')
                            fiveWeatherHumidityFive.text('Humidity: ' + fiveDayHumidityFive + '%')

                            // for (i = 0; i < 5; i++) {
                            //     var data = response.list[i]

                            //     // put card class and details here
                            // }
                        })
                })


        }
        renderFiveDay();

            function renderStoredCity() {

                // Render a new li for each todo
                for (var i = 0; i < cities.length; i++) {
                    var storedCities = cities[i];
                    var li = $('<li>');
                    li.text(storedCities);
                    citylist.append(li);
                }
            }


            function storeCities() {
                // Stringify and set "cities" key in localStorage to cities array
                localStorage.setItem("cities", JSON.stringify(cities));
            }

            $("#city-search").on("click", function (event) {
                event.preventDefault();
                var cityText = cityInput.val();
                if (cityText === "") {
                    return;
                }
                cities.push(cityText)
                cityInput.val();
                storeCities();
                renderStoredCity();

            });

        </script>

</body>

</html>